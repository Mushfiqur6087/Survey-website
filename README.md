# Trajectory Annotation Website - Trajectory Data Analysis

A full-stack web application for analyzing pedestrian trajectory data with knot-finding capabilities. The system consists of a Spring Boot backend, Next.js frontend, and Python data processing scripts.

## üöÄ Features

### Core Survey System
- **Interactive Knot Annotation**: Real-time trajectory curve visualization with click-to-place knot functionality
- **Advanced Canvas Rendering**: Sophisticated trajectory visualization with path connections and coordinate scaling
- **Session-Based Workflow**: Organized annotation sessions with automatic start/end point management
- **Multi-Trajectory Support**: Handle complex trajectory datasets with unique track identification

### Admin Panel
- **Secure Authentication**: Admin login system with session management
- **Comprehensive Dashboard**: Overview of annotation sessions and track statistics
- **Track Management**: Browse, view, and analyze individual trajectory tracks
- **Advanced Visualizations**: Canvas-based track detail views with trajectory-ordered path connections
- **Annotation Review**: View and manage knot annotations by session and track

### Technical Features
- **Real-time API**: RESTful endpoints for trajectory data access and knot annotation storage
- **Modern UI**: Responsive design with TailwindCSS, React components, and Recharts integration
- **Data Processing**: Python scripts for cleaning and transforming trajectory datasets
- **PostgreSQL Integration**: Persistent storage for trajectories, annotations, and admin data

## üèóÔ∏è Architecture

```
Survey-website/
‚îú‚îÄ‚îÄ Backend/          # Spring Boot REST API
‚îú‚îÄ‚îÄ frontend/         # Next.js React application
‚îî‚îÄ‚îÄ Dataset/          # Python data processing scripts
```

## üìã Prerequisites

Before running this application, ensure you have the following installed:

- **Java 17+** (for Spring Boot backend)
- **Node.js 18+** and **npm** (for Next.js frontend)
- **Python 3.8+** and **pip** (for data processing)
- **PostgreSQL 12+** (database)
- **Maven 3.6+** (for Java dependency management)

## üìä Data Requirements

This application requires specific trajectory data files. You need to have:

1. **Source Data Directory**: A directory (e.g., `/location-2`) containing:
   - `{date}-fps-{fps}-scene-{sceneId}-pedestrians.csv`
   - `{date}-fps-{fps}-scene-{sceneId}-others.csv`
   - `{date}-fps-{fps}-scene-{sceneId}-meta.csv`

2. **Python Dependencies**: The `tti_dataset_tools` library for trajectory processing

3. **Generated Data**: The `trajectory_data.json` file (generated by running data processing scripts)

### Example Data Structure
The CSV files should contain columns like:
- `uniqueTrackId`: Unique identifier for each trajectory
- `sceneX`, `sceneY`: Scene coordinates
- `sceneXVelocity`, `sceneYVelocity`: Velocity components
- `verticalDirection`: Direction of movement (NORTH/SOUTH)

## üõ†Ô∏è Installation & Setup

### 1. Clone the Repository
```bash
git clone <your-repository-url>
cd Survey-website
```

### 2. Database Setup
```bash
# Install and start PostgreSQL
sudo apt-get install postgresql postgresql-contrib  # Ubuntu/Debian
# OR
brew install postgresql  # macOS

# Start PostgreSQL service
sudo systemctl start postgresql  # Linux
# OR
brew services start postgresql  # macOS

# Create database
sudo -u postgres createdb surveydb

# Create user (optional, or use existing postgres user)
sudo -u postgres psql -c "CREATE USER postgres WITH PASSWORD 'postgres';"
sudo -u postgres psql -c "GRANT ALL PRIVILEGES ON DATABASE surveydb TO postgres;"
```

### 3. Data Processing Setup
```bash
cd Dataset/

# Install Python dependencies
pip install pandas tabulate seaborn matplotlib scipy numpy
pip install tti_dataset_tools  # Install the trajectory processing library

# Update the dataDir path in export_data.py to point to your data directory
# Edit export_data.py and change line 16:
# dataDir = "/path/to/your/trajectory/data"

# Run data processing to generate trajectory_data.json
python export_data.py
```

### 4. Backend Setup
```bash
cd Backend/

# Update database configuration if needed
# Edit src/main/resources/application.properties
# Update username/password if you're not using default postgres credentials

# Install dependencies and run
./mvnw clean install
./mvnw spring-boot:run

# Backend will be available at http://localhost:8080
```

### 5. Frontend Setup
```bash
cd frontend/

# Install dependencies
npm install

# Start development server
npm run dev

# Frontend will be available at http://localhost:3000
```

## üîß Configuration

### Backend Configuration
Update `Backend/src/main/resources/application.properties`:
```properties
# Database configuration
spring.datasource.url=jdbc:postgresql://localhost:5432/surveydb
spring.datasource.username=your_username
spring.datasource.password=your_password

# Server port (optional)
server.port=8080
```

### Data Processing Configuration
Update `Dataset/export_data.py`:
```python
# Update these parameters according to your data
dataDir = "/path/to/your/trajectory/data"
sceneId = 210
date = "2023-05-04"
fps = 10
```

### Frontend Configuration
The frontend automatically connects to the backend at `http://localhost:8080`. If you change the backend port, update the API base URL in `frontend/src/lib/api.ts`.

## üöÄ Running the Application

1. **Start PostgreSQL** database service
2. **Process Data**: Run `python Dataset/export_data.py` to generate trajectory data
3. **Start Backend**: Run `./mvnw spring-boot:run` in the `Backend/` directory
4. **Start Frontend**: Run `npm run dev` in the `frontend/` directory
5. **Access the application** at `http://localhost:3000`

### Application Workflow

#### For Survey Participants:
1. **Navigate to Survey**: Visit `/placeknots` for the interactive knot annotation interface
2. **View Trajectories**: Interactive trajectory curves are displayed using Recharts visualization
3. **Place Knots**: Click on trajectory curves to place knot annotations
4. **Session Management**: Annotations are automatically saved with session tracking

#### For Administrators:
1. **Admin Login**: Access `/admin` for secure authentication
2. **Dashboard Overview**: View annotation statistics and session summaries
3. **Track Management**: Browse individual tracks at `/admin/tracks`
4. **Detailed Analysis**: View advanced visualizations for specific tracks at `/admin/tracks/[trackId]`
5. **Review Annotations**: Examine knot placements and annotation data by session

## üì° API Endpoints

### Trajectory Data
| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/health` | Health check |
| GET | `/api/trajectories` | Get all trajectory data |
| GET | `/api/trajectories/unique-track-ids` | Get all unique track IDs |
| GET | `/api/trajectories/track/{id}` | Get trajectory for specific track |
| POST | `/api/trajectories/tracks` | Get trajectories for multiple tracks |
| GET | `/api/trajectories/random/{count}` | Get random track IDs |

### Knot Annotations
| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/api/knots/submit` | Submit knot annotation for a session |
| GET | `/api/knots/session/{sessionId}` | Get all knots for a specific session |
| GET | `/api/knots/session/{sessionId}/track/{trackId}` | Get knots for session and track |
| GET | `/api/knots/sessions` | Get all annotation sessions |

### Admin Panel
| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/api/admin/login` | Admin authentication |
| GET | `/api/admin/dashboard/stats` | Get dashboard statistics |
| GET | `/api/admin/tracks` | Get track management data |
| GET | `/api/admin/tracks/{trackId}` | Get detailed track information |

## üß™ Testing

### Backend Tests
```bash
cd Backend/
./mvnw test
```

### Frontend Tests
```bash
cd frontend/
npm test
```

## üìù Development Notes

### Frontend Architecture
- **Next.js 15** with App Router for modern React development
- **TailwindCSS** provides utility-first styling with custom design system
- **Recharts** library for interactive trajectory visualization and knot placement
- **Canvas API** integration for advanced trajectory rendering with path connections
- **TypeScript** for type-safe development

### Backend Architecture
- **Spring Boot 3** with REST API architecture
- **PostgreSQL** with JPA/Hibernate for data persistence
- **CORS** enabled for cross-origin requests
- **Entity Management**: TrajectoryData, KnotAnnotation, and Admin entities
- **Auto-DDL** for database schema management

### Key Components
- **Interactive Survey Interface**: Real-time knot annotation with coordinate transformation
- **Admin Dashboard**: Comprehensive management interface with advanced visualizations
- **Canvas Rendering**: Custom trajectory visualization with trajectory-ordered path connections
- **Session Management**: Organized annotation workflow with automatic data persistence

### Database Schema
- **trajectory_data**: Stores trajectory points with coordinates and metadata
- **knot_annotations**: Stores user-placed knot annotations with session tracking
- **admin**: Admin user authentication and session management

## üîç Troubleshooting

### Common Issues

1. **Database Connection Error**
   - Ensure PostgreSQL is running
   - Check database credentials in `application.properties`
   - Verify database `surveydb` exists

2. **Missing Trajectory Data**
   - Ensure `trajectory_data.json` exists in `Dataset/` directory
   - Run `python export_data.py` to generate the data
   - Check that source CSV files are accessible

3. **Frontend API Connection Error**
   - Ensure backend is running on port 8080
   - Check CORS configuration in the backend
   - Verify API endpoints are accessible

4. **Python Dependencies**
   - Install `tti_dataset_tools` library
   - Ensure all required Python packages are installed

## ü§ù Contributing

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/AmazingFeature`)
3. Commit your changes (`git commit -m 'Add some AmazingFeature'`)
4. Push to the branch (`git push origin feature/AmazingFeature`)
5. Open a Pull Request

## üìÑ License

This project is licensed under the MIT License - see the LICENSE file for details.

## üôè Acknowledgments

- **tti_dataset_tools** library for trajectory data processing
- **Spring Boot** for robust backend framework
- **Next.js** for modern React development
- **PostgreSQL** for reliable data storage
